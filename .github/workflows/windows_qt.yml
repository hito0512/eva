permissions:
  contents: write # 打开写入权限

name: Windows
on: 
  # push代码时触发workflow
  push:
    branches: [ "main" ]

jobs:
  build:
    name: Build platform
    # 运行平台， windows-latest目前是windows server 2019
    runs-on: windows-latest
    strategy:
      # 矩阵配置
      matrix:
        qt_ver: [5.15.2] # Qt 版本
        qt_target: [desktop] # 对象平台
        qt_arch: [win64_msvc2019_64] # 编译器

    # 步骤
    steps:
      # 安装Qt
      - name: Install Qt
        uses: jurplel/install-qt-action@v2
        with:
            version: ${{ matrix.qt_ver }} # 指定 Qt 版本
            host: 'windows'   # 主机系统
            target: ${{ matrix.qt_target }} # 目标平台
            arch: ${{ matrix.qt_arch }} # 架构和编译器
            dir: 'D:/'     # 安装目录
            modules: 'qtscript' # 指定额外的模块

      # 拉取代码
      - uses: actions/checkout@v1

      # 编译代码
      - name: Build eva
        id: cmake_build
        run: |
          mkdir build
          cd build
          cmake .. 
          cmake --build . --config Release -j 4

      # # 发布
      # - name: Create Release
      #   id: create_release
      #   uses: actions/create-release@v1
      #   env:
      #     GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      #   with:
      #     tag_name: test # tag号
      #     release_name: test # 本次发布名称
      #     draft: false
      #     prerelease: false
      # - name: Upload Release Asset
      #   uses: actions/upload-release-asset@v1
      #   env:
      #     GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      #   with:
      #     upload_url: ${{ steps.create_release.outputs.upload_url }}
      #     asset_path: D:\a\eva\eva\build\Release\eva.exe
      #     asset_name: eva_test.exe
      #     asset_content_type: application/x-msdownload
